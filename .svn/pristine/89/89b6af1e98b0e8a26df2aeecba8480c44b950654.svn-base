$(function () {
  var map = new BMap.Map("mapbox", {
    mapType: BMAP_HYBRID_MAP
  });
  var point = new BMap.Point(110.795905, 32.619646);
  map.centerAndZoom(point, 13);
  map.enableScrollWheelZoom(true);
  //地图
  $.ajax({
    type: 'get',
    url: url + 'projectHome',
    data: 'username=' + username,
    error: function (error) {
      console.log(error)
    },
    success: function (res) {
      console.log(res)
      var list=res.list;
      for(var i=0;i<list.length;i++){
        console.log(list[i])
        var opts = {
          width: 210, // 信息窗口宽度
          height: 83, // 信息窗口高度
          title: "<h4>项目名称:"+list[i].name+"</h4>", // 信息窗口标题
          enableMessage: true, //设置允许信息窗发送短息
          message: ""
        }
        if(list[i].aPid==''){
          var myIcon = new BMap.Icon("./image/bigData_03_t.png", new BMap.Size(20,30),{
            // 指定定位位置
            offset: new BMap.Size(10, 25),
            // 当需要从一幅较大的图片中截取某部分作为标注图标时，需要指定大图的偏移位置   
            imageOffset: new BMap.Size(0, 0 ) // 设置图片偏移  
          });
        }else{
          var myIcon = new BMap.Icon("./image/bigData_05_t.png", new BMap.Size(20,30),{
            // 指定定位位置
            offset: new BMap.Size(10, 25),
            // 当需要从一幅较大的图片中截取某部分作为标注图标时，需要指定大图的偏移位置   
            imageOffset: new BMap.Size(0, 0 ) // 设置图片偏移  
        });
        }
        var pp=list[i].longitude;
        if(pp.split(',')[0]>54){
          var lng=pp.split(',')[0]
          var lat=pp.split(',')[1]
        }else{
          var lng=pp.split(',')[1]
          var lat=pp.split(',')[0]
        }
        var pt=new BMap.Point(lng,lat)
        var marker = new BMap.Marker(pt,{icon:myIcon});  // 创建标注
        var content = `状态:<span style='${list[i].aPid==''?'color:#27CC32':'color:red'}'>${list[i].aPid==''?'正常':'报警'}</span>`//data_info[i][2];
        
        map.addOverlay(marker);               // 将标注添加到地图中
        addClickHandler(content,marker);
      }
      function addClickHandler(content,marker){
        marker.addEventListener("click",function(e){
          var p = e.target;
          var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
          var infoWindow = new BMap.InfoWindow(content,opts);  // 创建信息窗口对象 
          map.openInfoWindow(infoWindow,point); //开启信息窗口
        });
      }
    }
  })

  
})