<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>报警信息</title>
  <link rel="stylesheet" href="css/first.css">
  <link rel="stylesheet" href="css/header.css">
  <script src="http://api.map.baidu.com/api?v=3.0&ak=gQ5brR6pk0kIpWhZsGRhmU2T"></script>
  <link rel="stylesheet" href="css/map.css">
  <script type="text/javascript"
    src="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"></script>
  <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
  <link rel="stylesheet" href="css/layui-v2.4.5/layui/css/layui.css">
  <link rel="stylesheet" href="css/layui-v2.4.5/layui/css/layer.css">

  <script src="js/jquery-3.3.1.js"></script>
  <script src="js/jquery.ztree.core-3.5.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link href="css/MyTree.css" rel="stylesheet">
  <link href="css/zTreeStyle.css" rel="stylesheet">
  <link rel="stylesheet" href="css/scrnAdaptive.css">
  <link rel="stylesheet" href="css/waringMessage.css">

  <script src="js/url.js"></script>
  <style>
    table tr td {
      height: 25px;
    }

    #box {
      background: #212529;
    }

    .topTable {
      overflow: auto;
      height: 160px;
    }

    .outUl li {
      height: 25px;
    }
  </style>
</head>

<body>
  <div id="box">
    <div class='baojing'>

    </div>
    <audio src="./music/6709.mp3" id="auto"></audio>
    <div class='header' style='color:#fff;    text-align: center;'>
      <div class='headerTop'>
        <div class='smallBox30'>
          <span id='name'>屈显</span>
          <span id='role' style='margin-left:20px;'>超级管理员</span>
          <span id='time' style='margin-left:20px;'> 2020-09-01 周二 </span>
        </div>
        <div class='smallBox30'></div>
        <div class='smallBox30 headerTopRight'>
          <span>
            <a href="monitoring.html" style='color:#fff;'>
              <img src="./image/my.png" alt="">
              监控后台
            </a>
          </span>
          <span style='margin-left:30px;'>
            <a href="personCenter.html" style='color:#fff;'>
              <img src="./image/my.png" alt="">
              个人中心
            </a>

          </span>
          <span style='margin-left:30px;'>
            <a href="login.html" style='color:#fff;'>
              <img src="./image/exit.png" alt=""></i>
              退出
            </a>
          </span>
        </div>
      </div>
      <div class='headerBottom'>
        <div class='smallBox50'>
          <buttom class='bhBottom ' data-ad='0'>首页</buttom>
          <buttom class='bhBottom' data-ad='1'>实时数据</buttom>
          <buttom class='bhBottom ' data-ad='2'>报警信息</buttom>
        </div>
        <div class='smallBox30'></div>
        <div class='smallBox40' style='    text-align: left;
          padding-left: 170px;'>
          <buttom class='bhBottom active' data-ad='3'>监控中心</buttom>
          <buttom class='bhBottom' data-ad='4'>统计信息</buttom>
        </div>

      </div>
      <div class='title'>
        国家电网安防一体化监测平台
      </div>
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-xl" style="width: 1300px;">
        <div class="modal-content" style="background-color: #062F2B; color: #fff;">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">终端信息</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            123213
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
            <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
          </div>
        </div>
      </div>
    </div>
    <div class='bodyCenter' style='justify-content: space-around;height:807px'>
      <div class='bodyRight' style='overflow: hidden;width:100%;position: relative;border:none;'>
        <div style='width:100%;height:100%;' id="mapbox"></div>
        <div style='top:20px;left:25px;' class='serviceData'>
          <div class='bctitle' style="    margin: 7px 0 0 7px;">2019年服务数据</div>
          <span class="errorBtn" data-out='0'><i class='errorSpan'></i></span>
          <div style='width:100%;height:250px;display: flex;'>
            <div style='width:50%;height:250px;' id="alarmPie"></div>
            <div style='width:40%;height:200px;'>
              <div style='width:100%;height:50px;line-height:50px;'>
                <span style='font-size:20px;'>现场服务</span>
                <div style="display: inline-block;" id="serverTime">
                  <span class='serveRight'></span>
                  <span class='serveRight'></span>
                  <span class='serveRight'></span>
                  <span class='serveRight'></span>
                </div>
                <span style='font-size:20px;'>次</span>
              </div>
              <div style='width:90%;height:110px;    margin: 25px 10px 0 10px;' id="serverInfo">
              </div>
            </div>
          </div>
          <span class='trcorner'></span>
          <span class='tlcorner'></span>
          <span class='brcorner'></span>
          <span class='blcorner'></span>
        </div>
        <div style='top:35%;left:25px;' class="alarmRecord">
          <div class='bctitle' style="    margin: 7px 0 0 7px;">2019年报警记录</div>
          <span class="errorBtn" data-out='1'><i class='errorSpan'></i></span>
          <div style='width:90%;height:236px;margin:0 auto;' id="alarmPro">

          </div>
          <span class='trcorner'></span>
          <span class='tlcorner'></span>
          <span class='brcorner'></span>
          <span class='blcorner'></span>
        </div>
        <div style='top:20px;right:25px;' class='panalarm'>
          <div class='bctitle' style="  width:85%;  margin: 7px 0 0 7px;">当前报警设备<span class='alarmNum'>10个</span></div>
          <span class="errorBtn" data-out='2'><i class='errorSpan'></i></span>
          <div class=''>
            <ul style='width: 90%;margin: 15px auto 0px;overflow: auto;' id="panalUl">
              <!-- <li  style='border-bottom: 1px solid #1b5b46;padding-bottom: 10px;    margin-bottom: 10px;'>
                <ul class='outUl'>
                  <li>
                    <span style='color:#2DBB8B'>设备名称:</span>  u创谷
                  </li>
                  <li>
                    <span style='color:#2DBB8B'>单位名称:</span>  u创谷
                  </li>
                  <li>
                    <span style='color:#2DBB8B'>报警类型:</span>  u创谷
                  </li>
                  <li>
                    <span style='color:#2DBB8B'>设备编号:</span>  u创谷
                  </li>
                  <li>
                    <span style='color:#2DBB8B'>报警事件:</span>  u创谷
                  </li>
                </ul>
              </li> -->
            </ul>
            </table>

          </div>
          <div style='width:20px;height:20px;position: relative;margin: 0 auto;'>
            <i style="background:url('./image/drop.png');width:20px;height:20px;position:absolute;     background-size: 100% 100%;"
              id="alarmInfo" data-dir="drop"></i>
          </div>
          <span class='trcorner'></span>
          <span class='tlcorner'></span>
          <span class='brcorner'></span>
          <span class='blcorner'></span>
        </div>
        <div style='bottom:20px;right:25px; ' class='legend'>
          <div style="width:100%;height:53px;position: relative;">
            <img src="./image/green_yuan.png" alt="" style="width: 15%;
              position: absolute;
              top: 10px;
              left: 15px;">
            <span class='imgSpan'>正常</span>
          </div>
          <div style="width:100%;height:53px;position: relative;">
            <img src="./image/yellow_yuan.png" alt="" style="width: 15%;" class='imgPos'>
            <span class='imgSpan'>次要报警</span>
          </div>
          <!-- <div style="width:100%;height:53px;position: relative;">
            <img src="./image/bigData_07.png" alt="" style="width: 15%;
              position: absolute;
              top: 10px;
              left: 15px;">
            <span class='imgSpan'>重要报警</span>
          </div> -->
          <div style="width:100%;height:53px;position: relative;">
            <img src="./image/red_yuan.png" alt="" style="width: 15%;
              position: absolute;
              top: 10px;
              left: 15px;">
            <span class='imgSpan'>严重报警</span>
          </div>
        </div>
        <div
          style='width:350px; height:100px;position: absolute;bottom:20px;right:40%; display:flex;justify-content: space-around; '>
          <div style="width:30%;height:100px;">
            <div class='centerRound' data-out='0'>
              <i style="background:url('./image/bigData_1.png');width:35px;height:35px;position:absolute;    top: 22%;
                left: 33%;"></i>
              <span style="position:absolute;     top: 59%;
                left: 24%;color:#1CD295">服务数据</span>
            </div>
          </div>
          <div style='width:30%;height:100px;'>
            <div class='centerRound' data-out='1'>
              <i style="background:url('./image/bigData_2.png');width:35px;height:35px;position:absolute;    top: 22%;
                left: 33%;"></i>
              <span style="position:absolute;     top: 59%;
                left: 24%;color:#1CD295">报警设备</span>
            </div>
          </div>
          <div style='width:30%;height:100px;'>
            <div class='centerRound' data-out='2'>
              <i style="background:url('./image/bigData_3.png');width:35px;height:35px;position:absolute;    top: 22%;
                left: 33%;"></i>
              <span style="position:absolute;     top: 59%;
                left: 24%;color:#1CD295">报警记录</span>
            </div>
          </div>
        </div>
        <!-- <span class='trcorner'></span>
        <span class='tlcorner'></span>
        <span class='brcorner'></span>
        <span class='blcorner'></span> -->
      </div>
    </div>
  </div>
</body>
<script src="js/echarts.js"></script>
<script src="js/bigData.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
  integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
  integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous">
  </script>
<!-- <script src="js/bigTest.js"></script> -->
<script>
  $('.bhBottom').click(function () {
    console.log($(this).attr('data-ad'))
    var ad = $(this).attr('data-ad')
    if (ad == '0') {
      location.href = "index.html"
    } else if (ad == '1') {
      location.href = "real_time.html"
    } else if (ad == '2') {
      location.href = "waringMessage.html"
    } else if (ad == '3') {
      location.href = "bigData.html"
    } else if (ad == '4') {
      // location.href = "bigData.html"
    } else {
      location.href = ""
    }
  })
</script>
<script type="text/javascript">
  var audio = $("#auto")[0];

  var playAlarm = function () {
    playNum = 3;
    audio.play();
  };

  audio.addEventListener("ended", function () {
    if (playNum > 0) {
      playNum--;
      audio.play();
    }
  }, false);
  // playAlarm()
  var goEasy = GoEasy.getInstance({
    host: 'hangzhou.goeasy.io', //应用所在的区域地址: 【hangzhou.goeasy.io |singapore.goeasy.io】
    appkey: "BC-693f25464a694a14a5e0adbccb96051d" //替换为您的应用appkey
  });


  goEasy.connect({
    onSuccess: function () {  //连接成功
      console.log("GoEasy connect successfully.") //连接成功
    },
    onFailed: function (error) { //连接失败
      console.log("Failed to connect GoEasy, code:" + error.code + ",error:" + error.content);
    },
    onProgress: function (attempts) { //连接或自动重连中
      console.log("GoEasy is connecting", attempts);
    }
  });
  var userName = parseInt(localStorage.getItem('userName'));

  goEasy.subscribe({
    channel: userName.toString(),//替换为您自己的channel
    onMessage: function (message) {
      playAlarm()
      console.log(message, '我是message')
      const res = message.content
      const arr = res.split(',');

      $('.baojing').css('display', 'block')
      // $('.baojing').css('transition', 'all 1s;')
      html =
        `
                          <img src="./image/ygalarm.png" alt="" style="float: left;padding: 10px 0 0 10px;" width="90px" height="90px">
                          <div style="padding-left: 98px;">
                          <p style="float: right;margin-right: 30px;font-size: 20px;cursor: pointer;" id="outBaojing">X</p>
                          <p style="font-weight: 900;">报警类型:${arr[4]}</p>
                          <p>设备号:${arr[0]}</p>
                          <p>设备ID:${arr[1]}</p>
                          <p>设备地址:${arr[2]}</p>
                          <p>项目名称:${arr[3]}</p>			
              `
      $('.baojing').html(html)
      console.log("Channel:" + message.channel + " content:" + message.content);
      $('#outBaojing').click(() => {
        $('.baojing').css('display', 'none')
      })

    },
    onSuccess: function (message) {
      console.log(message)
      console.log("Channel订阅成功。");
    },
    onFailed: function (error) {
      console.log("Channel订阅失败, 错误编码：" + error.code + " 错误信息：" + error.content)
    }
  });





</script>

</html>